import{s as p,i as w}from"./supabase-client-BYSCEbDX.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";let u=null,l=null,d=null;const S=document.getElementById("pinScreen"),h=document.getElementById("kasaScreen"),E=document.getElementById("shiftScreen"),v=document.getElementById("mainScreen"),c=document.getElementById("pinInput"),r=document.getElementById("pinButton"),m=document.getElementById("pinError");c.addEventListener("keyup",e=>{e.key==="Enter"&&c.value.length===4&&r.click()});r.addEventListener("click",async()=>{const e=c.value;if(e.length!==4){f("4 haneli PIN girin!","error");return}r.disabled=!0,r.textContent="Kontrol ediliyor...",m.classList.remove("show");try{if(e==="0000"){console.log("Admin kontrolÃ¼ baÅŸladÄ±...");const{data:i,error:o}=await p.from("admins").select("*").eq("pin",e).single();if(console.log("Admin data:",i),console.log("Admin error:",o),i&&!o){f(`âœ… HoÅŸ geldiniz ${i.name}!`,"success"),setTimeout(()=>{window.location.href="admin-dashboard.html"},1500);return}else{console.error("Admin bulunamadÄ±:",o),m.textContent="âŒ Admin giriÅŸi baÅŸarÄ±sÄ±z! Supabase admins tablosunu kontrol edin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),5e3);return}}console.log("Kasiyer kontrolÃ¼ baÅŸladÄ±...");const{data:t,error:n}=await p.from("cashiers").select("*").eq("pin",e).single();console.log("Cashier data:",t),console.log("Cashier error:",n),t&&!n?(u=t,x(),r.disabled=!1,r.textContent="GiriÅŸ Yap"):(m.textContent="âŒ HatalÄ± PIN! LÃ¼tfen tekrar deneyin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),3e3))}catch(t){console.error("Genel hata:",t),m.textContent="âŒ BaÄŸlantÄ± hatasÄ±! Tekrar deneyin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),3e3)}});function x(){S.classList.add("hidden"),h.classList.remove("hidden"),showScoringInfo(),document.getElementById("kasaCashierName").textContent=u.name;const e=u.name.split(" ").map(n=>n[0]).join("");document.getElementById("kasaCashierAvatar").textContent=e;const t={"Tuba BozaklÄ±":"av-t","Elif YÄ±ldÄ±rÄ±m":"av-e","Melda YÄ±lmaz":"av-m","Ceren Erdem":"av-c"};document.getElementById("kasaCashierAvatar").className="cashier-avatar "+(t[u.name]||"av-t")}const I=document.querySelectorAll(".kasa-option"),F=document.getElementById("kasaButton"),C=document.getElementById("kasaBackButton");I.forEach(e=>{e.addEventListener("click",()=>{I.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),l=e.dataset.kasa,F.disabled=!1})});C.addEventListener("click",()=>{h.classList.add("hidden"),S.classList.remove("hidden"),l=null,I.forEach(e=>e.classList.remove("selected")),F.disabled=!0,c.value="",c.focus()});F.addEventListener("click",()=>{l&&D()});function D(){h.classList.add("hidden"),E.classList.remove("hidden"),document.getElementById("cashierName").textContent=u.name;const e={"Tuba BozaklÄ±":"av-t","Elif YÄ±ldÄ±rÄ±m":"av-e","Melda YÄ±lmaz":"av-m","Ceren Erdem":"av-c"},t=u.name.split(" ").map(L=>L[0]).join("");document.getElementById("cashierAvatar").textContent=t,document.getElementById("cashierAvatar").className="cashier-avatar "+(e[u.name]||"av-t");const n=document.getElementById("entryDate"),i=new Date,o=i.toISOString().split("T")[0];n.value=o,n.max=o;const k=new Date(i);k.setDate(k.getDate()-30),n.min=k.toISOString().split("T")[0];const y=document.querySelector(".date-note");y.innerHTML="BugÃ¼n iÃ§in veri girmek istiyorsanÄ±z tarihi deÄŸiÅŸtirmeyin."}document.getElementById("entryDate").addEventListener("change",e=>{const t=new Date(e.target.value);t.setHours(0,0,0,0);const n=new Date;n.setHours(0,0,0,0);const i=document.querySelector(".date-note");t<n?i.innerHTML=`
                    <span style="color:var(--orange);">âš ï¸ GeÃ§miÅŸ tarih seÃ§tiniz.</span>
                    GiriÅŸ otomatik olarak "GeÃ§" sayÄ±lacak (bonus puan yok).
                `:i.innerHTML="BugÃ¼n iÃ§in veri girmek istiyorsanÄ±z tarihi deÄŸiÅŸtirmeyin."});const b=document.querySelectorAll(".shift-option"),B=document.getElementById("shiftButton"),A=document.getElementById("shiftBackButton");b.forEach(e=>{e.addEventListener("click",()=>{b.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),d=e.dataset.shift,B.disabled=!1})});A.addEventListener("click",()=>{E.classList.add("hidden"),h.classList.remove("hidden"),d=null,b.forEach(e=>e.classList.remove("selected")),B.disabled=!0});B.addEventListener("click",()=>{d&&(console.log("Vardiya seÃ§ildi:",d),console.log("Kasa:",l),T())});async function T(){console.log("showMainScreen Ã§aÄŸrÄ±ldÄ±"),console.log("selectedKasa:",l),console.log("selectedShift:",d),E.classList.add("hidden"),v.classList.add("active");const e=d==="sabah"?"Sabah VardiyasÄ±":"AkÅŸam VardiyasÄ±",t=l==="restoran"?"Restoran":"Cafetarya",n=document.getElementById("entryDate").value,i=new Date(n).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit"});document.getElementById("navInfo").textContent=`${u.name} - ${t} - ${e} (${i})`,z(),d==="aksam"&&G()}const Z=document.getElementById("mainBackButton");Z.addEventListener("click",()=>{if(confirm("Veri giriÅŸinden Ã§Ä±kmak istediÄŸinize emin misiniz? GirdiÄŸiniz veriler kaybolacak.")){v.classList.remove("active"),E.classList.remove("hidden"),document.querySelectorAll('input[type="number"]').forEach(t=>{t.value="",t.placeholder="0.00"});const e=document.getElementById("cafeteriaAksamInfo");e&&e.remove()}});function z(){console.log("updateFormFields Ã§aÄŸrÄ±ldÄ±:",l,d),K(),l==="restoran"&&d==="sabah"||l==="restoran"&&d==="aksam"?(a("rumeliZ2Field"),a("gidaField"),a("kahveField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("meyveSuyuField"),a("kahvaltiField"),a("salataField"),s("rumeliZ2",!0)):l==="cafetarya"&&d==="sabah"?(a("rumeliZ1Field"),a("gidaField"),a("kahveField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("meyveSuyuField"),a("kahvaltiField"),a("dondurmaKategoriField"),s("rumeliZ1",!0)):l==="cafetarya"&&d==="aksam"&&(a("rumeliZ1Field"),a("balikEkmekField"),a("dondurmaZField"),s("rumeliZ1",!0),s("balikEkmek",!0),s("dondurmaZ",!0),a("gidaField"),a("kahvaltiField"),a("kahveField"),a("meyveSuyuField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("dondurmaKategoriField"),s("gida",!1),s("kahvalti",!1),s("kahve",!1),s("meyveSuyu",!1),s("sicakIcecek",!1),s("sogukIcecek",!1),s("tatli",!1),s("dondurmaKategori",!1),q()),console.log("Form alanlarÄ± gÃ¼ncellendi")}function K(){["rumeliZ1Field","rumeliZ2Field","balikEkmekField","dondurmaZField","gidaField","kahveField","sicakIcecekField","sogukIcecekField","tatliField","meyveSuyuField","kahvaltiField","salataField","dondurmaKategoriField"].forEach(t=>{const n=document.getElementById(t);if(n){n.style.display="none";const i=n.querySelector("input");i&&(i.value="",i.required=!1)}})}function a(e){const t=document.getElementById(e);t?t.style.display="block":console.warn(`Field not found: ${e}`)}function s(e,t){const n=document.getElementById(e);n&&(n.required=t)}function q(){const e=document.getElementById("cafeteriaAksamInfo");e&&e.remove();const t=document.createElement("div");t.id="cafeteriaAksamInfo",t.style.cssText="background:linear-gradient(135deg,rgba(139,92,246,.1),rgba(236,72,153,.1));border:1px solid rgba(139,92,246,.3);border-radius:14px;padding:18px;margin-bottom:20px;",t.innerHTML=`
                <div style="display:flex;align-items:flex-start;gap:14px;">
                    <div style="font-size:36px;flex-shrink:0;">ğŸŒ™</div>
                    <div>
                        <div style="font-weight:700;margin-bottom:8px;color:var(--txt);font-size:15px;">
                            AkÅŸam VardiyasÄ± - GÃ¼n Sonu KapanÄ±ÅŸ
                        </div>
                        <div style="font-size:13px;color:var(--txt2);line-height:1.6;">
                            <strong style="color:var(--orange);">âš ï¸ Ã–NEMLÄ°:</strong> TÃ¼m deÄŸerler <strong>GÃœN SONU TOPLAMDIR</strong> (Sabah + AkÅŸam birlikte).<br><br>

                            <strong style="color:var(--purple);">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</strong><br>
                            â€¢ Sabah vardiyasÄ± kapattÄ±: GÄ±da 2,000 â‚º<br>
                            â€¢ AkÅŸam vardiyasÄ± ekstra sattÄ±: +3,500 â‚º<br>
                            â€¢ <strong>Sen gÃ¼n sonu toplamÄ±nÄ± gireceksin: 5,500 â‚º</strong><br><br>

                            Sistem otomatik olarak sabah verisini Ã§Ä±karÄ±p senin performansÄ±nÄ± hesaplar.
                        </div>
                    </div>
                </div>
            `;const n=v.querySelector(".card");n&&v.insertBefore(t,n)}async function G(){const e=document.getElementById("entryDate").value,{data:t,error:n}=await p.from("daily_reports").select("*").eq("date",e).eq("kasa",l).eq("shift","sabah").maybeSingle();if(n){console.error("Sabah verisi Ã§ekme hatasÄ±:",n);return}if(!t){console.log("Sabah verisi bulunamadÄ± - normal (ilk vardiya)");return}console.log("Sabah verisi yÃ¼klendi:",t),[{id:"rumeliZ1",db:"rumeli_z1"},{id:"rumeliZ2",db:"rumeli_z2"},{id:"balikEkmek",db:"balik_ekmek"},{id:"dondurmaZ",db:"dondurma"},{id:"gida",db:"gida"},{id:"kahvalti",db:"kahvalti"},{id:"kahve",db:"kahve"},{id:"meyveSuyu",db:"meyvesuyu"},{id:"sicakIcecek",db:"sicak_icecek"},{id:"sogukIcecek",db:"soguk_icecek"},{id:"tatli",db:"tatli"},{id:"salata",db:"salata"},{id:"dondurmaKategori",db:"dondurma_kategori"}].forEach(o=>{const k=document.getElementById(o.id);if(k&&t[o.db]){const y=parseFloat(t[o.db]||0);k.placeholder=`Sabah: ${M(y)} - GÃ¼n sonu TOPLAM gir`,k.setAttribute("data-morning-value",y)}})}function M(e){return new Intl.NumberFormat("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)+" â‚º"}const g=document.getElementById("submitButton");g.addEventListener("click",async()=>{var i,o;const e={cashierId:u.id,kasa:l,shift:d,selectedDate:document.getElementById("entryDate").value,rumeliZ1:parseFloat(document.getElementById("rumeliZ1").value)||0,rumeliZ2:parseFloat(document.getElementById("rumeliZ2").value)||0,balikEkmek:parseFloat(document.getElementById("balikEkmek").value)||0,dondurma:parseFloat(document.getElementById("dondurmaZ").value)||0,gida:parseFloat(document.getElementById("gida").value)||0,kahve:parseFloat(document.getElementById("kahve").value)||0,sicakIcecek:parseFloat(document.getElementById("sicakIcecek").value)||0,sogukIcecek:parseFloat(document.getElementById("sogukIcecek").value)||0,tatli:parseFloat(document.getElementById("tatli").value)||0,meyveSuyu:parseFloat(document.getElementById("meyveSuyu").value)||0,kahvalti:parseFloat(document.getElementById("kahvalti").value)||0,salata:parseFloat((i=document.getElementById("salata"))==null?void 0:i.value)||0,dondurmaKategori:parseFloat((o=document.getElementById("dondurmaKategori"))==null?void 0:o.value)||0,dondurmaAdet:0,depo:0,notlar:""};g.disabled=!0,g.textContent="Kaydediliyor...";const{data:t,error:n}=await w(e);if(n){f("Hata: "+n.message,"error"),g.disabled=!1,g.textContent="ğŸ’¾ Kaydet ve Puan Kazan!";return}document.getElementById("pointsDisplay").textContent=`+${t.pointsEarned}`,f(`âœ… Kaydedildi! ${t.pointsEarned} puan kazandÄ±nÄ±z! ${t.isOnTime?"â° ZamanÄ±nda!":"âš ï¸ GeÃ§ giriÅŸ"}`,"success"),setTimeout(()=>{location.reload()},2e3)});function f(e,t="success"){const n=document.getElementById("toast");n.textContent=e,n.className=`toast ${t}`,setTimeout(()=>n.classList.add("show"),100),setTimeout(()=>n.classList.remove("show"),3e3)}window.showScoringInfo=function(){document.getElementById("scoringInfoModal").style.display="flex"};window.closeScoringInfo=function(){document.getElementById("scoringInfoModal").style.display="none"};c.focus();
