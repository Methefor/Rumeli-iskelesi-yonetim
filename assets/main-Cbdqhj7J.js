import{s as p,i as x}from"./supabase-client-DN31Znua.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";let u=null,o=null,d=null;const L=document.getElementById("pinScreen"),h=document.getElementById("kasaScreen"),E=document.getElementById("shiftScreen"),v=document.getElementById("mainScreen"),c=document.getElementById("pinInput"),r=document.getElementById("pinButton"),m=document.getElementById("pinError");c.addEventListener("keyup",e=>{e.key==="Enter"&&c.value.length===4&&r.click()});r.addEventListener("click",async()=>{const e=c.value;if(e.length!==4){f("4 haneli PIN girin!","error");return}r.disabled=!0,r.textContent="Kontrol ediliyor...",m.classList.remove("show");try{if(e==="0000"){console.log("Admin kontrolÃ¼ baÅŸladÄ±...");const{data:n,error:l}=await p.from("admins").select("*").eq("pin",e).single();if(console.log("Admin data:",n),console.log("Admin error:",l),n&&!l){f(`âœ… HoÅŸ geldiniz ${n.name}!`,"success"),setTimeout(()=>{window.location.href="admin-dashboard.html"},1500);return}else{console.error("Admin bulunamadÄ±:",l),m.textContent="âŒ Admin giriÅŸi baÅŸarÄ±sÄ±z! Supabase admins tablosunu kontrol edin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),5e3);return}}console.log("Kasiyer kontrolÃ¼ baÅŸladÄ±...");const{data:t,error:i}=await p.from("cashiers").select("*").eq("pin",e).single();console.log("Cashier data:",t),console.log("Cashier error:",i),t&&!i?(u=t,C(),r.disabled=!1,r.textContent="GiriÅŸ Yap"):(m.textContent="âŒ HatalÄ± PIN! LÃ¼tfen tekrar deneyin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),3e3))}catch(t){console.error("Genel hata:",t),m.textContent="âŒ BaÄŸlantÄ± hatasÄ±! Tekrar deneyin.",m.classList.add("show"),c.value="",c.focus(),r.disabled=!1,r.textContent="GiriÅŸ Yap",setTimeout(()=>m.classList.remove("show"),3e3)}});function C(){L.classList.add("hidden"),h.classList.remove("hidden"),document.getElementById("kasaCashierName").textContent=u.name;const e=u.name.split(" ").map(i=>i[0]).join("");document.getElementById("kasaCashierAvatar").textContent=e;const t={"Tuba BozaklÄ±":"av-t","Elif YÄ±ldÄ±rÄ±m":"av-e","Melda YÄ±lmaz":"av-m","Ceren Erdem":"av-c"};document.getElementById("kasaCashierAvatar").className="cashier-avatar "+(t[u.name]||"av-t")}const b=document.querySelectorAll(".kasa-option"),F=document.getElementById("kasaButton"),w=document.getElementById("kasaBackButton");b.forEach(e=>{e.addEventListener("click",()=>{b.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),o=e.dataset.kasa,F.disabled=!1})});w.addEventListener("click",()=>{h.classList.add("hidden"),L.classList.remove("hidden"),o=null,b.forEach(e=>e.classList.remove("selected")),F.disabled=!0,c.value="",c.focus()});F.addEventListener("click",()=>{o&&D()});function D(){h.classList.add("hidden"),E.classList.remove("hidden"),document.getElementById("cashierName").textContent=u.name;const e={"Tuba BozaklÄ±":"av-t","Elif YÄ±ldÄ±rÄ±m":"av-e","Melda YÄ±lmaz":"av-m","Ceren Erdem":"av-c"},t=u.name.split(" ").map(S=>S[0]).join("");document.getElementById("cashierAvatar").textContent=t,document.getElementById("cashierAvatar").className="cashier-avatar "+(e[u.name]||"av-t");const i=document.getElementById("entryDate"),n=new Date,l=n.toISOString().split("T")[0];i.value=l,i.max=l;const g=new Date(n);g.setDate(g.getDate()-30),i.min=g.toISOString().split("T")[0];const y=document.querySelector(".date-note");y.innerHTML="BugÃ¼n iÃ§in veri girmek istiyorsanÄ±z tarihi deÄŸiÅŸtirmeyin."}document.getElementById("entryDate").addEventListener("change",e=>{const t=new Date(e.target.value);t.setHours(0,0,0,0);const i=new Date;i.setHours(0,0,0,0);const n=document.querySelector(".date-note");t<i?n.innerHTML=`
                    <span style="color:var(--orange);">âš ï¸ GeÃ§miÅŸ tarih seÃ§tiniz.</span>
                    GiriÅŸ otomatik olarak "GeÃ§" sayÄ±lacak (bonus puan yok).
                `:n.innerHTML="BugÃ¼n iÃ§in veri girmek istiyorsanÄ±z tarihi deÄŸiÅŸtirmeyin."});const I=document.querySelectorAll(".shift-option"),B=document.getElementById("shiftButton"),T=document.getElementById("shiftBackButton");I.forEach(e=>{e.addEventListener("click",()=>{I.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),d=e.dataset.shift,B.disabled=!1})});T.addEventListener("click",()=>{E.classList.add("hidden"),h.classList.remove("hidden"),d=null,I.forEach(e=>e.classList.remove("selected")),B.disabled=!0});B.addEventListener("click",()=>{d&&(console.log("Vardiya seÃ§ildi:",d),console.log("Kasa:",o),z())});async function z(){console.log("showMainScreen Ã§aÄŸrÄ±ldÄ±"),console.log("selectedKasa:",o),console.log("selectedShift:",d),E.classList.add("hidden"),v.classList.add("active");const e=d==="sabah"?"Sabah VardiyasÄ±":"Ã–ÄŸle VardiyasÄ±",t=o==="restoran"?"Restoran":"Cafetarya",i=document.getElementById("entryDate").value,n=new Date(i).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit"});document.getElementById("navInfo").textContent=`${u.name} - ${t} - ${e} (${n})`,K(),d==="ogle"&&G()}const Z=document.getElementById("mainBackButton");Z.addEventListener("click",()=>{if(confirm("Veri giriÅŸinden Ã§Ä±kmak istediÄŸinize emin misiniz? GirdiÄŸiniz veriler kaybolacak.")){v.classList.remove("active"),E.classList.remove("hidden"),document.querySelectorAll('input[type="number"]').forEach(t=>{t.value="",t.placeholder="0.00"});const e=document.getElementById("cafeteriaOgleInfo");e&&e.remove()}});function K(){console.log("updateFormFields Ã§aÄŸrÄ±ldÄ±:",o,d),A(),o==="restoran"&&d==="sabah"||o==="restoran"&&d==="ogle"?(a("rumeliZ2Field"),a("gidaField"),a("kahveField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("meyveSuyuField"),a("kahvaltiField"),a("salataField"),s("rumeliZ2",!0)):o==="cafetarya"&&d==="sabah"?(a("rumeliZ1Field"),a("gidaField"),a("kahveField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("meyveSuyuField"),a("kahvaltiField"),a("dondurmaKategoriField"),s("rumeliZ1",!0)):o==="cafetarya"&&d==="ogle"&&(a("rumeliZ1Field"),a("balikEkmekField"),a("dondurmaZField"),s("rumeliZ1",!0),s("balikEkmek",!0),s("dondurmaZ",!0),a("gidaField"),a("kahvaltiField"),a("kahveField"),a("meyveSuyuField"),a("sicakIcecekField"),a("sogukIcecekField"),a("tatliField"),a("dondurmaKategoriField"),s("gida",!1),s("kahvalti",!1),s("kahve",!1),s("meyveSuyu",!1),s("sicakIcecek",!1),s("sogukIcecek",!1),s("tatli",!1),s("dondurmaKategori",!1),q()),console.log("Form alanlarÄ± gÃ¼ncellendi")}function A(){["rumeliZ1Field","rumeliZ2Field","balikEkmekField","dondurmaZField","gidaField","kahveField","sicakIcecekField","sogukIcecekField","tatliField","meyveSuyuField","kahvaltiField","salataField","dondurmaKategoriField"].forEach(t=>{const i=document.getElementById(t);if(i){i.style.display="none";const n=i.querySelector("input");n&&(n.value="",n.required=!1)}})}function a(e){const t=document.getElementById(e);t?t.style.display="block":console.warn(`Field not found: ${e}`)}function s(e,t){const i=document.getElementById(e);i&&(i.required=t)}function q(){const e=document.getElementById("cafeteriaOgleInfo");e&&e.remove();const t=document.createElement("div");t.id="cafeteriaOgleInfo",t.style.cssText="background:linear-gradient(135deg,rgba(139,92,246,.1),rgba(236,72,153,.1));border:1px solid rgba(139,92,246,.3);border-radius:14px;padding:18px;margin-bottom:20px;",t.innerHTML=`
                <div style="display:flex;align-items:flex-start;gap:14px;">
                    <div style="font-size:36px;flex-shrink:0;">ğŸ“Š</div>
                    <div>
                        <div style="font-weight:700;margin-bottom:8px;color:var(--txt);font-size:15px;">
                            Cafetarya Ã–ÄŸle VardiyasÄ± - GÃ¼n Sonu KapanÄ±ÅŸ
                        </div>
                        <div style="font-size:13px;color:var(--txt2);line-height:1.6;">
                            <strong style="color:var(--orange);">Ã–NEMLÄ°:</strong> TÃ¼m deÄŸerler <strong>GÃœN SONU TOPLAMDIR</strong> (Sabah + Ã–ÄŸle birlikte).<br><br>
                            
                            <strong style="color:var(--purple);">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</strong><br>
                            â€¢ Sabah vardiyasÄ± kapattÄ±: GÄ±da 2,000 â‚º<br>
                            â€¢ Ã–ÄŸle vardiyasÄ± ekstra sattÄ±: +3,500 â‚º<br>
                            â€¢ <strong>Sen gÃ¼n sonu toplamÄ±nÄ± gireceksin: 5,500 â‚º</strong><br><br>
                            
                            Sistem otomatik olarak sabah verisini Ã§Ä±karÄ±p sizin performansÄ±nÄ±zÄ± hesaplar.
                        </div>
                    </div>
                </div>
            `;const i=v.querySelector(".card");i&&v.insertBefore(t,i)}async function G(){const e=document.getElementById("entryDate").value,{data:t,error:i}=await p.from("daily_reports").select("*").eq("date",e).eq("kasa",o).eq("shift","sabah").single();if(i||!t){console.log("Sabah verisi bulunamadÄ±");return}console.log("Sabah verisi yÃ¼klendi:",t),[{id:"rumeliZ1",db:"rumeli_z1"},{id:"rumeliZ2",db:"rumeli_z2"},{id:"balikEkmek",db:"balik_ekmek"},{id:"dondurmaZ",db:"dondurma"},{id:"gida",db:"gida"},{id:"kahvalti",db:"kahvalti"},{id:"kahve",db:"kahve"},{id:"meyveSuyu",db:"meyvesuyu"},{id:"sicakIcecek",db:"sicak_icecek"},{id:"sogukIcecek",db:"soguk_icecek"},{id:"tatli",db:"tatli"},{id:"salata",db:"salata"},{id:"dondurmaKategori",db:"dondurma_kategori"}].forEach(l=>{const g=document.getElementById(l.id);if(g&&t[l.db]){const y=parseFloat(t[l.db]||0);g.placeholder=`Sabah: ${N(y)} - GÃ¼n sonu TOPLAM gir`,g.setAttribute("data-morning-value",y)}})}function N(e){return new Intl.NumberFormat("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)+" â‚º"}const k=document.getElementById("submitButton");k.addEventListener("click",async()=>{var n,l;const e={cashierId:u.id,kasa:o,shift:d,selectedDate:document.getElementById("entryDate").value,rumeliZ1:parseFloat(document.getElementById("rumeliZ1").value)||0,rumeliZ2:parseFloat(document.getElementById("rumeliZ2").value)||0,balikEkmek:parseFloat(document.getElementById("balikEkmek").value)||0,dondurma:parseFloat(document.getElementById("dondurmaZ").value)||0,gida:parseFloat(document.getElementById("gida").value)||0,kahve:parseFloat(document.getElementById("kahve").value)||0,sicakIcecek:parseFloat(document.getElementById("sicakIcecek").value)||0,sogukIcecek:parseFloat(document.getElementById("sogukIcecek").value)||0,tatli:parseFloat(document.getElementById("tatli").value)||0,meyveSuyu:parseFloat(document.getElementById("meyveSuyu").value)||0,kahvalti:parseFloat(document.getElementById("kahvalti").value)||0,salata:parseFloat((n=document.getElementById("salata"))==null?void 0:n.value)||0,dondurmaKategori:parseFloat((l=document.getElementById("dondurmaKategori"))==null?void 0:l.value)||0,dondurmaAdet:0,depo:0,notlar:""};k.disabled=!0,k.textContent="Kaydediliyor...";const{data:t,error:i}=await x(e);if(i){f("Hata: "+i.message,"error"),k.disabled=!1,k.textContent="ğŸ’¾ Kaydet ve Puan Kazan!";return}document.getElementById("pointsDisplay").textContent=`+${t.pointsEarned}`,f(`âœ… Kaydedildi! ${t.pointsEarned} puan kazandÄ±nÄ±z! ${t.isOnTime?"â° ZamanÄ±nda!":"âš ï¸ GeÃ§ giriÅŸ"}`,"success"),setTimeout(()=>{location.reload()},2e3)});function f(e,t="success"){const i=document.getElementById("toast");i.textContent=e,i.className=`toast ${t}`,setTimeout(()=>i.classList.add("show"),100),setTimeout(()=>i.classList.remove("show"),3e3)}c.focus();
