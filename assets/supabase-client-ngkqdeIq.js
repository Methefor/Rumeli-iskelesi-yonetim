import{createClient as f}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();const F="https://iwikwbjsznjuefvuemdb.supabase.co",g="sb_publishable_nnsBbg8U3oU3P8esLDvZTw_XOfU0ez7",c=f(F,g);async function y(e,l){const{data:o,error:n}=await c.from("cashiers").select("total_points").eq("id",e).single();if(n)return{data:null,error:n};const a=(o.total_points||0)+l;return await c.from("cashiers").update({total_points:a,updated_at:new Date().toISOString()}).eq("id",e).select()}async function b(e){const l=new Date(e.selectedDate);l.setHours(0,0,0,0);const o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate());let a=!1;if(l.getTime()===n.getTime()){const t=o.getHours(),m=o.getMinutes();e.shift==="sabah"?a=t<17:e.shift==="aksam"&&(t>=16&&t<=23||t===0&&m<=30?a=!0:a=!1)}else a=!1;const s=e.gida&&e.kahve&&e.sicakIcecek&&e.sogukIcecek&&e.tatli&&e.meyveSuyu&&e.kahvalti;let i=10;a&&(i+=5),s&&(i+=10);let r={rumeli_z1:parseFloat(e.rumeliZ1)||0,rumeli_z2:parseFloat(e.rumeliZ2)||0,balik_ekmek:parseFloat(e.balikEkmek)||0,dondurma:parseFloat(e.dondurma)||parseFloat(e.dondurmaZ)||0,gida:parseFloat(e.gida)||0,kahvalti:parseFloat(e.kahvalti)||0,kahve:parseFloat(e.kahve)||0,meyvesuyu:parseFloat(e.meyveSuyu)||0,sicak_icecek:parseFloat(e.sicakIcecek)||0,soguk_icecek:parseFloat(e.sogukIcecek)||0,tatli:parseFloat(e.tatli)||0,salata:parseFloat(e.salata)||0,dondurma_kategori:parseFloat(e.dondurmaKategori)||0};if(e.shift==="aksam"){const{data:t,error:m}=await c.from("daily_reports").select("*").eq("date",e.selectedDate).eq("kasa",e.kasa).eq("shift","sabah").single();t&&!m&&(console.log("Sabah verisi bulundu, bireysel performans hesaplanıyor..."),r.rumeli_z1=Math.max(0,(r.rumeli_z1||0)-(parseFloat(t.rumeli_z1)||0)),r.rumeli_z2=Math.max(0,(r.rumeli_z2||0)-(parseFloat(t.rumeli_z2)||0)),r.balik_ekmek=Math.max(0,(r.balik_ekmek||0)-(parseFloat(t.balik_ekmek)||0)),r.dondurma=Math.max(0,(r.dondurma||0)-(parseFloat(t.dondurma)||0)),r.gida=Math.max(0,(r.gida||0)-(parseFloat(t.gida)||0)),r.kahvalti=Math.max(0,(r.kahvalti||0)-(parseFloat(t.kahvalti)||0)),r.kahve=Math.max(0,(r.kahve||0)-(parseFloat(t.kahve)||0)),r.meyvesuyu=Math.max(0,(r.meyvesuyu||0)-(parseFloat(t.meyvesuyu)||0)),r.sicak_icecek=Math.max(0,(r.sicak_icecek||0)-(parseFloat(t.sicak_icecek)||0)),r.soguk_icecek=Math.max(0,(r.soguk_icecek||0)-(parseFloat(t.soguk_icecek)||0)),r.tatli=Math.max(0,(r.tatli||0)-(parseFloat(t.tatli)||0)),r.salata=Math.max(0,(r.salata||0)-(parseFloat(t.salata)||0)),r.dondurma_kategori=Math.max(0,(r.dondurma_kategori||0)-(parseFloat(t.dondurma_kategori)||0)))}const _=Math.max(0,r.rumeli_z1+r.rumeli_z2+r.balik_ekmek+r.dondurma),h=(parseFloat(e.rumeliZ1)||0)+(parseFloat(e.rumeliZ2)||0)+(parseFloat(e.balikEkmek)||0)+(parseFloat(e.dondurma)||parseFloat(e.dondurmaZ)||0),u={date:e.selectedDate,cashier_id:e.cashierId,kasa:e.kasa,shift:e.shift,register_name:"Rumeli İskelesi",rumeli_z1:parseFloat(e.rumeliZ1)||0,rumeli_z2:parseFloat(e.rumeliZ2)||0,balik_ekmek:parseFloat(e.balikEkmek)||0,dondurma:parseFloat(e.dondurma)||parseFloat(e.dondurmaZ)||0,dondurma_adet:parseFloat(e.dondurmaAdet)||0,gida:parseFloat(e.gida)||0,kahve:parseFloat(e.kahve)||0,sicak_icecek:parseFloat(e.sicakIcecek)||0,soguk_icecek:parseFloat(e.sogukIcecek)||0,tatli:parseFloat(e.tatli)||0,meyvesuyu:parseFloat(e.meyveSuyu)||0,kahvalti:parseFloat(e.kahvalti)||0,salata:parseFloat(e.salata)||0,dondurma_kategori:parseFloat(e.dondurmaKategori)||0,depo:parseFloat(e.depo)||0,notlar:e.notlar||"",total_revenue:h,individual_revenue:_,entry_time:o.toISOString(),is_on_time:a,points_earned:i},{data:p,error:k}=await c.from("daily_reports").insert([u]).select().single();if(k)return{data:null,error:k};const d={cashier_id:e.cashierId,report_id:p.id,shift:e.shift,kasa:e.kasa,entry_time:o.toISOString(),is_on_time:a,is_complete:s,points_earned:i,revenue_amount:u.rumeli_z1+u.rumeli_z2+u.balik_ekmek+u.dondurma+u.salata};return await c.from("entry_history").insert([d]),await y(e.cashierId,i),{data:{...p,pointsEarned:i,isOnTime:a,isComplete:s},error:null}}export{b as i,c as s};
