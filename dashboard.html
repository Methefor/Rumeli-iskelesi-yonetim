<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Rumeli ƒ∞skelesi Dashboard - Canlƒ± Analizler">
    <meta name="theme-color" content="#2563eb">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
    <title>Rumeli ƒ∞skelesi - Dashboard</title>
    
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; height: 300px; }
    </style>
</head>
<body class="bg-gray-50" x-data="dashboard()">
    
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">üìä</span>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Dashboard</h1>
                        <p class="text-sm text-gray-500">Canlƒ± Analiz</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button @click="refreshData" class="text-gray-600 hover:text-gray-900">
                        <i data-feather="refresh-cw" class="w-5 h-5"></i>
                    </button>
                    <a href="index.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 flex items-center space-x-2">
                        <i data-feather="plus" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Veri Gir</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- Date & Time -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-900" x-text="currentDate"></h2>
                <p class="text-gray-500" x-text="'Son g√ºncelleme: ' + lastUpdate"></p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-500">Toplam Kayƒ±t</p>
                <p class="text-2xl font-bold text-gray-900" x-text="totalRecords"></p>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Bug√ºnk√º Ciro -->
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-3xl">üí∞</span>
                    <span class="bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm font-semibold">Bug√ºn</span>
                </div>
                <p class="text-sm opacity-90 mb-2">Toplam Ciro</p>
                <p class="text-3xl font-bold mb-2" x-text="formatCurrency(stats.today.total)"></p>
                <div class="flex items-center space-x-2 text-sm">
                    <span x-show="stats.today.total >= stats.today.target">‚úÖ</span>
                    <span x-show="stats.today.total < stats.today.target">‚ö†Ô∏è</span>
                    <span x-text="'Hedef: ' + formatCurrency(stats.today.target)"></span>
                </div>
            </div>

            <!-- Bu Hafta -->
            <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-3xl">üìÖ</span>
                    <span class="bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm font-semibold">Hafta</span>
                </div>
                <p class="text-sm opacity-90 mb-2">Bu Hafta</p>
                <p class="text-3xl font-bold mb-2" x-text="formatCurrency(stats.week.total)"></p>
                <div class="flex items-center space-x-2 text-sm">
                    <span x-text="'Ort: ' + formatCurrency(stats.week.average)"></span>
                </div>
            </div>

            <!-- Bu Ay -->
            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-3xl">üìä</span>
                    <span class="bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm font-semibold">Ay</span>
                </div>
                <p class="text-sm opacity-90 mb-2">Bu Ay</p>
                <p class="text-3xl font-bold mb-2" x-text="formatCurrency(stats.month.total)"></p>
                <div class="flex items-center space-x-2 text-sm">
                    <span x-text="stats.month.days + ' g√ºn'"></span>
                </div>
            </div>

            <!-- En √áok Satan -->
            <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-3xl">üèÜ</span>
                    <span class="bg-white bg-opacity-20 rounded-full px-3 py-1 text-sm font-semibold">Top</span>
                </div>
                <p class="text-sm opacity-90 mb-2">En √áok Satan</p>
                <p class="text-2xl font-bold mb-2" x-text="stats.topCategory.name"></p>
                <div class="flex items-center space-x-2 text-sm">
                    <span x-text="stats.topCategory.count + ' adet'"></span>
                </div>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- G√ºnl√ºk Trend -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üìà Son 7 G√ºn√ºn Ciro Trendi</h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Kasa Daƒüƒ±lƒ±mƒ± -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üè™ Kasa Daƒüƒ±lƒ±mƒ± (Bug√ºn)</h3>
                <div class="chart-container">
                    <canvas id="kasaChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Kategori Satƒ±≈ülarƒ± -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üçΩÔ∏è Kategori Satƒ±≈ülarƒ±</h3>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <!-- Hafta ƒ∞√ßi vs Hafta Sonu -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Hafta ƒ∞√ßi vs Hafta Sonu</h3>
                <div class="chart-container">
                    <canvas id="weekdayChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Detaylƒ± Tablo -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-gray-900">üìã Son Kayƒ±tlar</h3>
                <button @click="exportToExcel" class="text-blue-600 hover:text-blue-700 font-semibold flex items-center space-x-2">
                    <i data-feather="download" class="w-4 h-4"></i>
                    <span>Excel ƒ∞ndir</span>
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Tarih</th>
                            <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Toplam Ciro</th>
                            <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Hedef</th>
                            <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Ger√ßekle≈üme</th>
                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Durum</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <template x-for="(row, index) in recentData" :key="index">
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3 text-sm text-gray-900" x-text="row.date"></td>
                                <td class="px-4 py-3 text-sm text-gray-900 text-right font-semibold" x-text="formatCurrency(row.total)"></td>
                                <td class="px-4 py-3 text-sm text-gray-500 text-right" x-text="formatCurrency(row.target)"></td>
                                <td class="px-4 py-3 text-sm text-right font-semibold" 
                                    :class="row.percentage >= 100 ? 'text-green-600' : 'text-orange-600'" 
                                    x-text="'%' + row.percentage.toFixed(0)"></td>
                                <td class="px-4 py-3 text-center">
                                    <span x-show="row.percentage >= 100">‚úÖ</span>
                                    <span x-show="row.percentage < 100 && row.percentage >= 90">‚ö†Ô∏è</span>
                                    <span x-show="row.percentage < 90">üî¥</span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <script src="js/sheets-api.js"></script>
    <script>
        feather.replace();
        
        function dashboard() {
            return {
                currentDate: new Date().toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' }),
                lastUpdate: new Date().toLocaleTimeString('tr-TR'),
                totalRecords: 0,
                stats: {
                    today: { total: 0, target: 25000 },
                    week: { total: 0, average: 0 },
                    month: { total: 0, days: 0 },
                    topCategory: { name: 'Sƒ±cak ƒ∞√ßecek', count: 0 }
                },
                recentData: [],
                charts: {},
                
                async init() {
                    await this.loadData();
                    this.createCharts();
                },
                
                async loadData() {
                    try {
                        const data = await getFromSheets();
                        this.processData(data);
                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                },
                
                processData(data) {
                    if (data.length < 2) return; // Skip header
                    
                    this.totalRecords = data.length - 1;
                    const rows = data.slice(1); // Skip header
                    
                    // Process recent data
                    this.recentData = rows.slice(-10).reverse().map(row => ({
                        date: row[1],
                        total: parseFloat(row[2] || 0) + parseFloat(row[3] || 0) + parseFloat(row[4] || 0) + parseFloat(row[5] || 0),
                        target: [6, 0].includes(new Date(row[1]).getDay()) ? 44000 : 25000,
                        percentage: 0
                    }));
                    
                    this.recentData.forEach(row => {
                        row.percentage = (row.total / row.target) * 100;
                    });
                    
                    // Calculate stats
                    if (this.recentData.length > 0) {
                        this.stats.today.total = this.recentData[0].total;
                    }
                },
                
                createCharts() {
                    // Trend Chart
                    const trendCtx = document.getElementById('trendChart');
                    this.charts.trend = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: this.recentData.slice(0, 7).map(d => d.date),
                            datasets: [{
                                label: 'G√ºnl√ºk Ciro',
                                data: this.recentData.slice(0, 7).map(d => d.total),
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                },
                
                formatCurrency(value) {
                    return new Intl.NumberFormat('tr-TR', {
                        style: 'currency',
                        currency: 'TRY',
                        minimumFractionDigits: 0
                    }).format(value || 0);
                },
                
                async refreshData() {
                    await this.loadData();
                    this.lastUpdate = new Date().toLocaleTimeString('tr-TR');
                },
                
                exportToExcel() {
                    // TODO: Implement Excel export
                    alert('Excel export √∂zelliƒüi yakƒ±nda eklenecek!');
                }
            }
        }
    </script>
</body>
</html>
